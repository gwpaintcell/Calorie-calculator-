<script>
  // Handle unit switching
  const heightUnit = document.getElementById('heightUnit');
  const weightUnit = document.getElementById('weightUnit');

  heightUnit.addEventListener('change', () => {
    const isMetric = heightUnit.value === 'cm';
    document.getElementById('heightMetric').style.display = isMetric ? 'block' : 'none';
    document.getElementById('heightImperial').style.display = isMetric ? 'none' : 'block';
  });

  weightUnit.addEventListener('change', () => {
    const isMetric = weightUnit.value === 'kg';
    document.getElementById('weightMetric').style.display = isMetric ? 'block' : 'none';
    document.getElementById('weightImperial').style.display = isMetric ? 'none' : 'block';
  });

  // Form logic
  document.getElementById('calorieForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const gender = document.getElementById('gender').value;
    const age = parseInt(document.getElementById('age').value);

    // Convert height
    let heightCm;
    if (heightUnit.value === 'cm') {
      heightCm = parseFloat(document.getElementById('height').value);
    } else {
      const feet = parseInt(document.getElementById('feet').value);
      const inches = parseInt(document.getElementById('inches').value);
      heightCm = (feet * 12 + inches) * 2.54;
    }

    // Convert weight
    let weightKg;
    if (weightUnit.value === 'kg') {
      weightKg = parseFloat(document.getElementById('weight').value);
    } else {
      const stone = parseInt(document.getElementById('stone').value);
      const pounds = parseInt(document.getElementById('pounds').value);
      weightKg = (stone * 14 + pounds) * 0.453592;
    }

    const activityFactor = parseFloat(document.getElementById('activity').value);
    const steps = parseInt(document.getElementById('steps').value);
    const intake = parseFloat(document.getElementById('calories').value);

    // BMR Calculation
    let bmr;
    if (gender === 'male') {
      bmr = 10 * weightKg + 6.25 * heightCm - 5 * age + 5;
    } else {
      bmr = 10 * weightKg + 6.25 * heightCm - 5 * age - 161;
    }

    const stepCalories = steps * 0.04;
    const tdee = Math.round(bmr * activityFactor + stepCalories);
    const diff = intake - tdee;

    let message;
    if (diff < -250) {
      message = `You're in a calorie deficit of ${Math.abs(diff)} calories. Expect weight loss. ✅`;
    } else if (diff > 250) {
      message = `You're in a calorie surplus of ${diff} calories. Expect weight gain. ⚠️`;
    } else {
      message = `You're around maintenance. Slight deficit/surplus of ${Math.abs(diff)} calories. ⚖️`;
    }

    const resultHTML = `
      <strong>Your Results:</strong><br/>
      BMR: ${Math.round(bmr)} kcal/day<br/>
      Estimated TDEE: ${tdee} kcal/day<br/>
      Calorie Intake: ${intake} kcal/day<br/><br/>
      <strong>${message}</strong>
    `;

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = resultHTML;
    resultDiv.style.display = 'block';
  });
</script>
